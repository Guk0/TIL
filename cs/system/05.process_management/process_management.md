# Process Management

### 프로세스 ID
- pid, 각 프로세스는 해당 시점에 유니크한 pid를 가짐
- pid 최대 값은  32768(2^15 → 부호형이기 때문)
- 부호형(signed) 16비트 정수값 사용
- 최근 할당된 pid가 200이라면, 그 이후 201, 202.. 등으로 할당

### 프로세스 계층
- 최초 프로세스 : init 프로세스이며 pid는 1이다.
- init 프로세스는 운영체제가 생성
- 프로세스는 부모 프로세스와 자식 프로세스로 구성.
- ppid 값이 부모 프로세스의 pid를 뜻함


### 리눅스 명령어
- ps -ef
  - -e : 시스템 상의 모든 프로세스에 대한 정보 출력
  - -f : UID(사용자 이름), PID, PPID, CPU%, STIME, TTY, TIME, CMD
  

### 프로세스 시스템 콜
- getpid() 와 getppid()


### fork()와 exec() 시스템 콜
- fork()
  - 별도의 프로세스 공간을 만들고 **부모 프로세스 공간의 데이터를 복사**하여 자식 프로세스를 만듦
- exec()
  - exec() 시스템 콜을 호출한 **현재 프로세스 공간**의 TEXT, DATA, BSS 영역을 **새로운 프로세스의 이미지**로 덮어씌움
  - 별도의 프로세스 공간을 만들지 않음.


### execl()와 execlp() 시스템 콜 사용법
- execl("파일 경로", "명령어 인수 리스트", "끝은 NULL");
  - execl("/bin/ls", "ls", "-al", NULL);
- execp("파일 이름", "명령어 인수 리스트", "끝은 NULL");
  - execlp("ls", "ls", "-al", NULL);
  - 파일 이름을 해당 프로세스를 실행한 프로세스의 환경변수(path)를 검색함
  - 명령어 인수 리스트
    - argv[0] = "ls"
    - argv[1] = "-al"
    - $ ls -al

### exec 함수들의 차이
- execlp() : 인자가 파일 이름
- execl() : 인자가 파일명을 포함한 전체 경로
- execle() : 인자가 별도로 정의한 환경변수


### wait() 시스템 콜
- wait() 함수를 사용하면 fork() 함수 호출시 부모 프로세스는 자식 프로세스가 종료할 때까지 wait.
- 자식과 부모 프로세스의 동기화 혹은 자식 프로세스보다 부모 프로세스가 먼저 죽는 경우를 막기 위해 사용(고아 프로세스, 좀비 프로세스)
- 자식 프로세스가 종료되면 좀비 프로세스가 되어 최소 정보만 가지고 있는 상태가 됨
- 완전히 끝나면 해당 정보도 삭제되고 부모 프로세스에 SIGCHLD 시그널을 보냄

### copy-on-write
- 자식 프로세스 생성시, **부모 프로세스 페이지를 우선 사용**
- 부모 또는 자식 프로세스가 해당 페이지를 **읽기가 아닌 쓰기**를 할 때 페이지를 복사하고 분리
- 프로세스 생성 시간을 줄일 수 있고 페이지 수를 최소화할 수 있음.


### 프로세스 종료
- exit() : 프로세스 종료
- atexit()
  - 프로세스 종료 시 실행될 함수를 등록하기 위해 사용
  - 등록된 함수를 등록된 역 순서대로 실행
- WIFEXITED()를 통해 자식 프로세스의 종료 상태를 확인할 수 있다.(정상인지 비정상인지)

### 우선순위 기반 스케쥴러
- nice() 시스템 콜
- root가 소유한 프로세스만 우선순위를 높일 수 있음.
  - 다른 프로세스는 우선순위를 낮출 수만 있음
  - 스케쥴링 방식에 따라 우선순위가 적용될 수도 있고 안될 수도 있음
- getpriority()
  - 프로세스(PRIO_PROCESS), 프로세스 그룹(PRIO_PGRP), 사용자(PRIO_USER)별로 우선순위를 가져올 수 있음
- setpriority()